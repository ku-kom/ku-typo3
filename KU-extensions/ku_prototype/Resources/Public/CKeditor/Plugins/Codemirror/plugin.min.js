/*
*  The "codemirror" plugin. It's indented to enhance the
*  "sourcearea" editing mode, which displays the xhtml source code with
*  syntax highlight and line numbers.
* Licensed under the MIT license
* CodeMirror Plugin: http://codemirror.net/ (MIT License)
*/

function LineChannelToOffSet(e,o){var t=o.line,r=t+o.ch;for(i=0;i<t;i++)r+=e.getLine(i).length;return r}function OffSetToLineChannel(e,o){var t=0,r=0,n=0;for(i=0;i<e.lineCount();i++){if(len=e.getLine(i).length,o<n+len)return{line:t=i,ch:r=o-n};len++,n+=len}return{line:t,ch:r}}function IsStyleSheetAlreadyLoaded(e){return null!=CKEDITOR.document.getHead().findOne('link[href="'+e+'"]')}!function(){CKEDITOR.plugins.add("codemirror",{lang:"af,ar,bg,bn,bs,ca,cs,cy,da,de,el,en-au,en-ca,en-gb,en,eo,es,et,eu,fa,fi,fo,fr-ca,fr,gl,gu,he,hi,hr,hu,is,it,ja,ka,km,ko,ku,lt,lv,mk,mn,ms,nb,nl,no,pl,pt-br,pt,ro,ru,sk,sl,sr-latn,sr,sv,th,tr,ug,uk,vi,zh-cn,zh",version:"1.18.1",init:function(o){o.addCommand("codemirrorAbout",new CKEDITOR.dialogCommand("codemirrorAboutDialog")).modes={wysiwyg:1,source:1},CKEDITOR.dialog.add("codemirrorAboutDialog",this.path+"dialogs/codemirrorAbout.js");var t=this.path,r={autoCloseBrackets:!0,autoCloseTags:!0,autoFormatOnStart:!1,autoFormatOnUncomment:!1,autoLoadCodeMirror:!0,continueComments:!0,enableCodeFolding:!0,enableCodeFormatting:!0,enableSearchTools:!0,highlightMatches:!0,indentWithTabs:!1,lineNumbers:!0,lineWrapping:!0,mode:"htmlmixed",matchBrackets:!0,maxHighlightLineLength:1e3,matchTags:!0,showAutoCompleteButton:!0,showCommentButton:!0,showFormatButton:!0,showSearchButton:!0,showTrailingSpace:!0,showUncommentButton:!0,styleActiveLine:!0,theme:"default",useBeautifyOnStart:!1,hintOptions:null,extraKeys:{"Ctrl-Space":"autocomplete","Ctrl-Q":function(e){i.enableCodeFolding&&window["foldFunc_"+o.id](e,e.getCursor().line)}}},i=CKEDITOR.tools.extend(r,o.config.codemirror||{},!0),n=o.lang.codemirror;o.config.codemirror_theme&&(i.theme=o.config.codemirror_theme),o.config.codemirror_autoFormatOnStart&&(i.autoFormatOnStart=o.config.codemirror_autoFormatOnStart),o.plugins.bbcode&&i.mode.indexOf("bbcode")<=0&&(i.mode="bbcode");var d,a="function"==typeof require&&"function"==typeof require.config;if(a){var c=i.requireContext||"_",m=CKEDITOR.getUrl("plugins/codemirror/js/");m=m.substring(0,m.length-1),d=require.config({context:c,packages:[{name:"codemirror",location:m,main:"codemirror.min.js"},{name:"codemirror-mode-handlebars",location:m,main:"codemirror.mode.handlebars.min.js"},{name:"codemirror-mode-twig",location:m,main:"codemirror.mode.twig.min.js"},{name:"codemirror-mode-html",location:m,main:"codemirror.mode.htmlmixed.min.js"},{name:"codemirror-mode-php",location:m,main:"codemirror.mode.php.min.js"},{name:"codemirror-mode-js",location:m,main:"codemirror.mode.js.min.js"},{name:"codemirror-addons",location:m,main:"codemirror.addons.min.js"},{name:"codemirror-addon-search",location:m,main:"codemirror.addons.search.min.js"},{name:"codemirror-beautify",location:m,main:"beautify.min.js"}],bundles:{codemirror:["core","codemirror.js"],"codemirror-mode-handlebars":["modeHandlebars"],"codemirror-mode-twig":["modeTwig"],"codemirror-mode-html":["modeHtml"],"codemirror-mode-php":["modePHP"],"codemirror-mode-js":["modeJS"],"codemirror-addons":["addons"],"codemirror-addon-search":["addonSearch"],"codemirror-beautify":["beautifyModule"]},map:{"*":{"lib/codemirror":"codemirror.js"}}})}(o.elementMode===CKEDITOR.ELEMENT_MODE_INLINE||o.plugins.sourcedialog)&&CKEDITOR.dialog.add("sourcedialog",function(e){var o,r=CKEDITOR.document.getWindow().getViewPaneSize(),c=Math.min(r.width-70,800),m=r.height/1.5;function s(e,o,t){var r=t.getSize(),n=r.width,d=r.height/1.5,a=i.mode;"handlebars"==a?a={name:"handlebars",base:"text/html"}:"twig"==a&&(a={name:"twig",base:"text/html"}),window["codemirror_"+e.id]=CodeMirror.fromTextArea(o,{direction:e.lang.dir,mode:a,matchBrackets:i.matchBrackets,maxHighlightLineLength:i.maxHighlightLineLength,matchTags:i.matchTags,workDelay:300,workTime:35,readOnly:e.readOnly,lineNumbers:i.lineNumbers,lineWrapping:i.lineWrapping,autoCloseTags:i.autoCloseTags,autoCloseBrackets:i.autoCloseBrackets,highlightSelectionMatches:i.highlightMatches,continueComments:i.continueComments,indentWithTabs:i.indentWithTabs,theme:i.theme,showTrailingSpace:i.showTrailingSpace,showCursorWhenSelecting:!0,styleActiveLine:i.styleActiveLine,hintOptions:i.hintOptions,viewportMargin:1/0,extraKeys:i.extraKeys,foldGutter:!0,gutters:["CodeMirror-linenumbbers","CodeMirror-foldgutter"]}),window["codemirror_"+e.id].display.wrapper.classList.add("cke_enable_context_menu");var c,m,s=d+"px",l=n+"px";if(window["codemirror_"+e.id].config=i,i.autoFormatOnStart)if(i.useBeautifyOnStart){var u=window["codemirror_"+e.id].getValue();window["codemirror_"+e.id].setValue(html_beautify(u,4," ",120,"collapse"))}else window["codemirror_"+e.id].autoFormatAll({line:0,ch:0},{line:window["codemirror_"+e.id].lineCount(),ch:0});(window["codemirror_"+e.id].on("change",function(){window["codemirror_"+e.id].save(),e.fire("change",this)}),window["codemirror_"+e.id].setSize(l,s),i.lineNumbers&&i.enableCodeFolding&&window["codemirror_"+e.id].on("gutterClick",window["foldFunc_"+e.id]),"function"==typeof i.onLoad&&i.onLoad(window["codemirror_"+e.id],e),window["codemirror_"+e.id].on("blur",function(){e.fire("blur",this)}),window["codemirror_"+e.id].on("keypress",function(o,t){if(i.enableCodeFormatting){var r={from:window["codemirror_"+e.id].getCursor(!0),to:window["codemirror_"+e.id].getCursor(!1)};"keydown"!==t.type||!t.ctrlKey||75!==t.keyCode||t.shiftKey||t.altKey?"keydown"===t.type&&t.ctrlKey&&75===t.keyCode&&t.shiftKey&&!t.altKey?(window["codemirror_"+e.id].commentRange(!1,r.from,r.to),i.autoFormatOnUncomment&&window["codemirror_"+e.id].autoFormatRange(r.from,r.to)):"keydown"===t.type&&t.ctrlKey&&75===t.keyCode&&!t.shiftKey&&t.altKey&&window["codemirror_"+e.id].autoFormatRange(r.from,r.to):window["codemirror_"+e.id].commentRange(!0,r.from,r.to)}}),e.plugins.textselection&&textRange&&!e.config.fullPage)&&(c=OffSetToLineChannel(window["codemirror_"+e.id],textRange.startOffset),void 0===textRange.endOffset?(window["codemirror_"+e.id].focus(),window["codemirror_"+e.id].setCursor(c)):(window["codemirror_"+e.id].focus(),m=OffSetToLineChannel(window["codemirror_"+e.id],textRange.endOffset),window["codemirror_"+e.id].setSelection(c,m)))}return{title:e.lang.sourcedialog.title,minWidth:c,minHeight:m,resizable:CKEDITOR.DIALOG_RESIZE_BOTH,onLoad:function(){this.on("resize",function(o){var t=o.sender.parts,r=t.title,i=t.footer,n=o.data.height-r.$.offsetHeight-i.$.offsetHeight+"px",d=o.data.width+"px";window["codemirror_"+e.id].setSize(d,n)},this)},onShow:function(r){this.getContentElement("main","data").focus(),this.getContentElement("main","AutoComplete").setValue(i.autoCloseTags,!0);var n=this.getContentElement("main","data").getInputElement().$;this.setValueOf("main","data",o=e.getData()),i.autoLoadCodeMirror&&(IsStyleSheetAlreadyLoaded(t+"css/codemirror.min.css")||CKEDITOR.document.appendStyleSheet(t+"css/codemirror.min.css"),i.theme.length&&"default"!=i.theme&&!IsStyleSheetAlreadyLoaded(t+"theme/"+i.theme+".css")&&CKEDITOR.document.appendStyleSheet(t+"theme/"+i.theme+".css"),a?d(l(),function(o,t){s(e,n,r.sender)}):"undefined"==typeof CodeMirror?CKEDITOR.scriptLoader.load(t+"js/codemirror.min.js",function(){CKEDITOR.scriptLoader.load(u(),function(){s(e,n,r.sender)})}):CodeMirror.prototype.autoFormatAll?s(e,n,r.sender):CKEDITOR.scriptLoader.load(u(),function(){s(e,n,r.sender)}))},onCancel:function(o){o.data.hide&&(window["codemirror_"+e.id].toTextArea(),window["codemirror_"+e.id]=null,e.fire("blur",this),e.fire("focus",this))},onOk:function(){function t(o){var t=this;e.setData(o,function(){t.hide();var o=e.createRange();o.moveToElementEditStart(e.editable()),o.select()})}return function(){window["codemirror_"+e.id].toTextArea(),window["codemirror_"+e.id]=null;var r=this.getValueOf("main","data").replace(/\r/g,"");return r===o?(e.fire("blur",this),e.fire("focus",this),!0):(CKEDITOR.env.ie?CKEDITOR.tools.setTimeout(t,0,this,r):t.call(this,r),e.fire("blur",this),e.fire("focus",this),!1)}}(),contents:[{id:"main",label:e.lang.sourcedialog.title,elements:[{type:"hbox",style:"width: 80px;margin:0;",widths:["20px","20px","20px","20px"],children:[{type:"button",id:"searchCode",label:"",title:n.searchCode,class:"searchCodeButton cke_button_icon",onClick:function(){CodeMirror.commands.find(window["codemirror_"+e.id])}},{type:"button",id:"replaceCode",label:"",title:n.replaceCode,class:"replaceCodeButton",onClick:function(){CodeMirror.commands.replace(window["codemirror_"+e.id])}},{type:"button",id:"autoFormat",label:"",title:n.autoFormat,class:"autoFormat",onClick:function(){var o={from:window["codemirror_"+e.id].getCursor(!0),to:window["codemirror_"+e.id].getCursor(!1)};window["codemirror_"+e.id].autoFormatRange(o.from,o.to)}},{type:"button",id:"CommentSelectedRange",label:"",title:n.commentSelectedRange,class:"CommentSelectedRange",onClick:function(){var o={from:window["codemirror_"+e.id].getCursor(!0),to:window["codemirror_"+e.id].getCursor(!1)};window["codemirror_"+e.id].commentRange(!0,o.from,o.to)}},{type:"button",id:"UncommentSelectedRange",label:"",title:n.uncommentSelectedRange,class:"UncommentSelectedRange",onClick:function(){var o={from:window["codemirror_"+e.id].getCursor(!0),to:window["codemirror_"+e.id].getCursor(!1)};window["codemirror_"+e.id].commentRange(!1,o.from,o.to),window["codemirror_"+e.id].config.autoFormatOnUncomment&&window["codemirror_"+e.id].autoFormatRange(o.from,o.to)}},{type:"button",id:"codemirrorAbout",label:"",title:n.dlgTitle,class:"codemirrorAbout",onClick:function(){e.execCommand("codemirrorAbout")}}]},{type:"checkbox",id:"AutoComplete",label:n.autoCompleteToggle,title:n.autoCompleteToggle,onChange:function(){window["codemirror_"+e.id].setOption("autoCloseTags",this.getValue())}},{type:"textarea",id:"data",dir:"ltr",inputStyle:"cursor:auto;width:"+c+"px;height:"+m+"px;tab-size:4;text-align:left;",class:"cke_source cke_enable_context_menu"}]}]}}),o.commands.find&&(o.commands.find.modes={wysiwyg:1,source:1},o.commands.find.exec=function(){"wysiwyg"===o.mode?o.openDialog("find"):CodeMirror.commands.find(window["codemirror_"+o.id])}),o.commands.replace&&(o.commands.replace.modes={wysiwyg:1,source:1},o.commands.replace.exec=function(){"wysiwyg"===o.mode?o.openDialog("find",function(){this.selectPage("replace")}):CodeMirror.commands.replace(window["codemirror_"+o.id])});var s=CKEDITOR.plugins.sourcearea;function l(){var e=["core","addons"];switch(i.mode){case"bbcode":case"bbcodemixed":e.push("modeHtml");break;case"application/x-httpd-php":e.push("modePHP");break;case"text/javascript":e.push("modeJs");break;case"handlebars":e.push("modeHandlebars");break;case"twig":e.push("modeTwig");break;case"htmlmixed":case"text/html":default:e.push("modeHtml")}return i.useBeautifyOnStart&&e.push("beautifyModule"),i.enableSearchTools&&e.push("addonSearch"),e}function u(){var e=[t+"js/codemirror.addons.min.js"];switch(i.mode){case"handlebars":e.push(t+"js/codemirror.mode.handlebars.min.js");case"bbcode":e.push(t+"js/codemirror.mode.bbcode.min.js");break;case"bbcodemixed":e.push(t+"js/codemirror.mode.bbcodemixed.min.js");break;case"htmlmixed":case"text/html":e.push(t+"js/codemirror.mode.htmlmixed.min.js");break;case"application/x-httpd-php":e.push(t+"js/codemirror.mode.php.min.js");break;case"text/javascript":e.push(t+"js/codemirror.mode.javascript.min.js");break;case"twig":case"twig":e.push(t+"js/codemirror.mode.twig.min.js");break;case"text/x-mssql":case"text/x-mysql":case"text/x-pgsql":case"text/x-sql":e.push(t+"js/codemirror.mode.sql.min.js");break;default:e.push(t+"js/codemirror.mode.htmlmixed.min.js")}return i.useBeautifyOnStart&&e.push(t+"js/beautify.min.js"),i.enableSearchTools&&e.push(t+"js/codemirror.addons.search.min.js"),e}function w(o){var t=o.ui.space("contents").getDocument().createElement("textarea");t.setStyles(CKEDITOR.tools.extend({width:CKEDITOR.env.ie7Compat?"99%":"100%",height:"100%",resize:"none",outline:"none","text-align":"left"},CKEDITOR.tools.cssVendorPrefix("tab-size",o.config.sourceAreaTabSize||4)));var r=[o.lang.editor,o.name].join(",");t.setAttributes({dir:"ltr",tabIndex:CKEDITOR.env.webkit?-1:o.tabIndex,role:"textbox","aria-label":r}),t.addClass("cke_source"),t.addClass("cke_reset"),t.addClass("cke_enable_context_menu"),o.ui.space("contents").append(t),window["editable_"+o.id]=o.editable(new e(o,t)),window["editable_"+o.id].setData(o.getData(1)),window["editable_"+o.id].editorID=o.id,o.fire("ariaWidget",this);var n=window["editable_"+o.id],d=n.getParent();function a(e){for(var o=[[CKEDITOR.SHIFT,"Shift-"],[CKEDITOR.CTRL,"Ctrl-"],[CKEDITOR.ALT,"Alt-"]],t="",r=0;r<o.length;r++)e&o[r][0]&&(e-=o[r][0],t+=o[r][1]);return CodeMirror.keyNames[e]?t+CodeMirror.keyNames[e]:null}i.lineNumbers&&i.enableCodeFolding&&(window["foldFunc_"+o.id]=CodeMirror.newFoldFunction(CodeMirror.tagRangeFinder)),function(e){var t=o.keystrokeHandler.keystrokes;for(var r in t){var i=a(r);null!==i&&"Enter"!==i&&function(t){e[i]=function(){o.execCommand(t)}}(t[r])}}(i.extraKeys);var c=i.mode;"handlebars"==c?c={name:"handlebars",base:"text/html"}:"twig"==i.mode&&(c={name:"twig",base:"text/html"}),window["codemirror_"+o.id]=CodeMirror.fromTextArea(n.$,{direction:o.lang.dir,mode:c,matchBrackets:i.matchBrackets,maxHighlightLineLength:i.maxHighlightLineLength,matchTags:i.matchTags,workDelay:300,workTime:35,readOnly:o.readOnly,lineNumbers:i.lineNumbers,lineWrapping:!0,autoCloseTags:i.autoCloseTags,autoCloseBrackets:i.autoCloseBrackets,highlightSelectionMatches:i.highlightMatches,continueComments:i.continueComments,indentWithTabs:i.indentWithTabs,theme:i.theme,showTrailingSpace:i.showTrailingSpace,showCursorWhenSelecting:!0,hintOptions:i.hintOptions,styleActiveLine:i.styleActiveLine,extraKeys:i.extraKeys,foldGutter:!0,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"]}),window["codemirror_"+o.id].display.wrapper.classList.add("cke_enable_context_menu");var m=0==d.$.clientHeight?o.ui.space("contents").getStyle("height"):d.$.clientHeight+"px";d.$.clientWidth;if(window["codemirror_"+o.id].config=i,i.autoFormatOnStart)if(i.useBeautifyOnStart){var s=window["codemirror_"+o.id].getValue();window["codemirror_"+o.id].setValue(html_beautify(s,4," ",120,"collapse"))}else window["codemirror_"+o.id].autoFormatAll({line:0,ch:0},{line:window["codemirror_"+o.id].lineCount(),ch:0});window["codemirror_"+o.id].on("change",function(){window["codemirror_"+o.id].save(),o.fire("change",this)}),window["codemirror_"+o.id].setSize(null,m),i.lineNumbers&&i.enableCodeFolding&&window["codemirror_"+o.id].on("gutterClick",window["foldFunc_"+o.id]),"function"==typeof i.onLoad&&i.onLoad(window["codemirror_"+o.id],o),window["codemirror_"+o.id].on("blur",function(){o.fire("blur",this)}),window["codemirror_"+o.id].on("keypress",function(e,t){if(i.enableCodeFormatting){var r={from:window["codemirror_"+o.id].getCursor(!0),to:window["codemirror_"+o.id].getCursor(!1)};"keydown"!==t.type||!t.ctrlKey||75!==t.keyCode||t.shiftKey||t.altKey?"keydown"===t.type&&t.ctrlKey&&75===t.keyCode&&t.shiftKey&&!t.altKey?(window["codemirror_"+o.id].commentRange(!1,r.from,r.to),i.autoFormatOnUncomment&&window["codemirror_"+o.id].autoFormatRange(r.from,r.to)):"keydown"===t.type&&t.ctrlKey&&75===t.keyCode&&!t.shiftKey&&t.altKey&&window["codemirror_"+o.id].autoFormatRange(r.from,r.to):window["codemirror_"+o.id].commentRange(!0,r.from,r.to)}})}s.commands.searchCode||(CKEDITOR.plugins.sourcearea.commands={source:{modes:{wysiwyg:1,source:1},editorFocus:!1,readOnly:1,exec:function(e){"wysiwyg"===e.mode&&e.fire("saveSnapshot"),e.getCommand("source").setState(CKEDITOR.TRISTATE_DISABLED),e.setMode("source"===e.mode?"wysiwyg":"source")},canUndo:!1},searchCode:{modes:{wysiwyg:0,source:1},editorFocus:!1,readOnly:1,exec:function(e){CodeMirror.commands.find(window["codemirror_"+e.id])},canUndo:!0},autoFormat:{modes:{wysiwyg:0,source:1},editorFocus:!1,readOnly:1,exec:function(e){var o={from:window["codemirror_"+e.id].getCursor(!0),to:window["codemirror_"+e.id].getCursor(!1)};window["codemirror_"+e.id].autoFormatRange(o.from,o.to)},canUndo:!0},commentSelectedRange:{modes:{wysiwyg:0,source:1},editorFocus:!1,readOnly:1,exec:function(e){var o={from:window["codemirror_"+e.id].getCursor(!0),to:window["codemirror_"+e.id].getCursor(!1)};window["codemirror_"+e.id].commentRange(!0,o.from,o.to)},canUndo:!0},uncommentSelectedRange:{modes:{wysiwyg:0,source:1},editorFocus:!1,readOnly:1,exec:function(e){var o={from:window["codemirror_"+e.id].getCursor(!0),to:window["codemirror_"+e.id].getCursor(!1)};window["codemirror_"+e.id].commentRange(!1,o.from,o.to),window["codemirror_"+e.id].config.autoFormatOnUncomment&&window["codemirror_"+e.id].autoFormatRange(o.from,o.to)},canUndo:!0},autoCompleteToggle:{modes:{wysiwyg:0,source:1},editorFocus:!1,readOnly:1,exec:function(e){this.state==CKEDITOR.TRISTATE_ON?window["codemirror_"+e.id].setOption("autoCloseTags",!1):this.state==CKEDITOR.TRISTATE_OFF&&window["codemirror_"+e.id].setOption("autoCloseTags",!0),this.toggleState()},canUndo:!0}}),o.addMode("source",function(e){i.autoLoadCodeMirror&&(IsStyleSheetAlreadyLoaded(t+"css/codemirror.min.css")||CKEDITOR.document.appendStyleSheet(t+"css/codemirror.min.css"),i.theme.length&&"default"!=i.theme&&!IsStyleSheetAlreadyLoaded(t+"theme/"+i.theme+".css")&&CKEDITOR.document.appendStyleSheet(t+"theme/"+i.theme+".css"),a?d(l(),function(){w(o),e()}):"undefined"==typeof CodeMirror?CKEDITOR.scriptLoader.load(t+"js/codemirror.min.js",function(){CKEDITOR.scriptLoader.load(u(),function(){w(o),e()})}):CodeMirror.prototype.autoFormatAll?(w(o),e()):CKEDITOR.scriptLoader.load(u(),function(){w(o),e()}))}),o.addCommand("source",s.commands.source),o.ui.addButton&&o.ui.addButton("Source",{label:o.lang.codemirror.toolbar,command:"source",toolbar:"mode,10"}),i.enableCodeFormatting&&(o.addCommand("searchCode",s.commands.searchCode),o.addCommand("autoFormat",s.commands.autoFormat),o.addCommand("commentSelectedRange",s.commands.commentSelectedRange),o.addCommand("uncommentSelectedRange",s.commands.uncommentSelectedRange),o.addCommand("autoCompleteToggle",s.commands.autoCompleteToggle),o.ui.addButton&&((i.showFormatButton||i.showCommentButton||i.showUncommentButton||i.showSearchButton)&&o.ui.add("-",CKEDITOR.UI_SEPARATOR,{toolbar:"mode,30"}),i.showFormatButton&&o.ui.addButton("autoFormat",{icon:this.path+"icons/autoformat.svg",label:n.autoFormat,command:"autoFormat",toolbar:"mode,50"}),i.showCommentButton&&o.ui.addButton("CommentSelectedRange",{icon:this.path+"icons/commentselectedrange.svg",label:n.commentSelectedRange,command:"commentSelectedRange",toolbar:"mode,60"}),i.showUncommentButton&&o.ui.addButton("UncommentSelectedRange",{icon:this.path+"icons/uncommentselectedrange.svg",label:n.uncommentSelectedRange,command:"uncommentSelectedRange",toolbar:"mode,70"}),i.showAutoCompleteButton&&o.ui.addButton("AutoComplete",{icon:this.path+"icons/autocomplete.svg",label:n.autoCompleteToggle,command:"autoCompleteToggle",toolbar:"mode,80"}),o.ui.addButton("codemirrorAbout",{icon:this.path+"icons/codemirror.svg",label:n.dlgTitle,command:"codemirrorAbout",toolbar:"mode,90"}))),o.on("beforeModeUnload",function(e){if("source"===o.mode&&o.plugins.textselection&&!o.config.fullPage){var t=o.getTextSelection();t.startOffset=LineChannelToOffSet(window["codemirror_"+o.id],window["codemirror_"+o.id].getCursor(!0)),t.endOffset=LineChannelToOffSet(window["codemirror_"+o.id],window["codemirror_"+o.id].getCursor(!1)),delete t.element,t.createBookmark(o),sourceBookmark=!0,o.undoManager&&o.undoManager.unlock(),e.data=t.content}}),o.on("mode",function(){var e,t;(o.getCommand("source").setState("source"===o.mode?CKEDITOR.TRISTATE_ON:CKEDITOR.TRISTATE_OFF),"source"===o.mode)&&("autoCompleteToggle"in o.commands&&o.getCommand("autoCompleteToggle").setState(window["codemirror_"+o.id].config.autoCloseTags?CKEDITOR.TRISTATE_ON:CKEDITOR.TRISTATE_OFF),o.plugins.textselection&&textRange&&!o.config.fullPage&&(e=OffSetToLineChannel(window["codemirror_"+o.id],textRange.startOffset),void 0===textRange.endOffset?(window["codemirror_"+o.id].focus(),window["codemirror_"+o.id].setCursor(e)):(window["codemirror_"+o.id].focus(),t=OffSetToLineChannel(window["codemirror_"+o.id],textRange.endOffset),window["codemirror_"+o.id].setSelection(e,t))))}),o.on("resize",function(){if(window["editable_"+o.id]&&"source"===o.mode){var e=window["editable_"+o.id].getParent(),t=e.$.clientHeight+"px",r=e.$.clientWidth+"px";window["codemirror_"+o.id].setSize(r,t)}}),o.on("readOnly",function(){window["editable_"+o.id]&&"source"===o.mode&&window["codemirror_"+o.id].setOption("readOnly",this.readOnly)}),o.on("instanceReady",function(e){var t=o.commands.selectAll;null!=t&&(t.exec=function(){if("source"===o.mode)window["codemirror_"+o.id].setSelection({line:0,ch:0},{line:window["codemirror_"+o.id].lineCount(),ch:0});else{var e=o.editable();if(e.is("body"))o.document.$.execCommand("SelectAll",!1,null);else{var t=o.createRange();t.selectNodeContents(e),t.select()}o.forceNextSelectionCheck(),o.selectionChange()}})}),"undefined"!=typeof jQuery&&jQuery('a[data-toggle="tab"]')&&window["codemirror_"+o.id]&&jQuery('a[data-toggle="tab"]').on("shown.bs.tab",function(){window["codemirror_"+o.id].refresh()}),o.on("setData",function(e){window["editable_"+e.editor.id]&&"source"===e.editor.mode&&window["codemirror_"+e.editor.id].setValue(e.data.dataValue)})}});var e=CKEDITOR.tools.createClass({base:CKEDITOR.editable,proto:{setData:function(e){this.setValue(e),window["editable_"+this.editor.id]&&"source"===this.editor.mode&&window["codemirror_"+this.editor.id].setValue(e),this.editor.fire("dataReady")},getData:function(){return this.getValue()},insertHtml:function(){},insertElement:function(){},insertText:function(){},setReadOnly:function(e){this[(e?"set":"remove")+"Attribute"]("readOnly","readonly")},editorID:null,detach:function(){window["codemirror_"+this.editorID].toTextArea(),window["editable_"+this.editorID]=null,window["codemirror_"+this.editorID]=null,e.baseProto.detach.call(this),this.clearCustomData(),this.remove()}}})}(),CKEDITOR.plugins.sourcearea={commands:{source:{modes:{wysiwyg:1,source:1},editorFocus:!1,readOnly:1,exec:function(e){"wysiwyg"===e.mode&&e.fire("saveSnapshot"),e.getCommand("source").setState(CKEDITOR.TRISTATE_DISABLED),e.setMode("source"===e.mode?"wysiwyg":"source")},canUndo:!1},searchCode:{modes:{wysiwyg:0,source:1},editorFocus:!1,readOnly:1,exec:function(e){CodeMirror.commands.find(window["codemirror_"+e.id])},canUndo:!0},autoFormat:{modes:{wysiwyg:0,source:1},editorFocus:!1,readOnly:0,exec:function(e){var o={from:window["codemirror_"+e.id].getCursor(!0),to:window["codemirror_"+e.id].getCursor(!1)};window["codemirror_"+e.id].autoFormatRange(o.from,o.to)},canUndo:!0},commentSelectedRange:{modes:{wysiwyg:0,source:1},editorFocus:!1,readOnly:0,exec:function(e){var o={from:window["codemirror_"+e.id].getCursor(!0),to:window["codemirror_"+e.id].getCursor(!1)};window["codemirror_"+e.id].commentRange(!0,o.from,o.to)},canUndo:!0},uncommentSelectedRange:{modes:{wysiwyg:0,source:1},editorFocus:!1,readOnly:0,exec:function(e){var o={from:window["codemirror_"+e.id].getCursor(!0),to:window["codemirror_"+e.id].getCursor(!1)};window["codemirror_"+e.id].commentRange(!1,o.from,o.to),window["codemirror_"+e.id].config.autoFormatOnUncomment&&window["codemirror_"+e.id].autoFormatRange(o.from,o.to)},canUndo:!0},autoCompleteToggle:{modes:{wysiwyg:0,source:1},editorFocus:!1,readOnly:1,exec:function(e){this.state==CKEDITOR.TRISTATE_ON?window["codemirror_"+e.id].setOption("autoCloseTags",!1):this.state==CKEDITOR.TRISTATE_OFF&&window["codemirror_"+e.id].setOption("autoCloseTags",!0),this.toggleState()},canUndo:!0}}};